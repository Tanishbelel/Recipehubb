{% extends "base.html" %} 
{% block start %}

<div class="container mt-4">
    <!-- Username display -->
    <div class="welcome-banner mb-4">
        <h4 class="fw-bold">Add Recipes</h4>
        <p class="text-muted mb-0">Welcome, {{request.user}}</p>
    </div>

    <!-- Add Recipe Form -->
    <div class="col-12 mx-auto card shadow-lg border-0 mb-4">
        <div class="card-body p-4">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <h4 class="card-title mb-4 fw-bold">Add New Recipe</h4>
                
                <div class="mb-3">
                    <label class="form-label small fw-bold">Recipe Name</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light border-end-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-book" viewBox="0 0 16 16">
                                <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
                            </svg>
                        </span>
                        <input type="text" required name="recipe_name" class="form-control bg-light border-start-0" placeholder="Enter recipe name">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label small fw-bold">Recipe Description</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light border-end-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
                                <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                                <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                            </svg>
                        </span>
                        <textarea name="recipe_des" class="form-control bg-light border-start-0" rows="3" required placeholder="Enter recipe description"></textarea>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label small fw-bold">Recipe Image</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light border-end-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
                                <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                            </svg>
                        </span>
                        <input name="recipe_image" type="file" class="form-control bg-light border-start-0" accept="image/*">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg px-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg me-2" viewBox="0 0 16 16">
                        <path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"/>
                    </svg>
                    Add Recipe
                </button>
            </form>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <form class="d-flex gap-2">
                <div class="input-group">
                    <span class="input-group-text bg-light border-end-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                    </span>
                    <input type="search" name="search" class="form-control bg-light border-start-0" placeholder="Search recipes..." value="{{ request.GET.search }}">
                </div>
                <button type="submit" class="btn btn-primary px-4">Search</button>
            </form>
        </div>
    </div>

    <!-- Recipes Table -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="bg-light">
                    <tr>
                        <th scope="col" class="px-4">#</th>
                        <th scope="col">Recipe Name</th>
                        <th scope="col">Recipe Description</th>
                        <th scope="col">Recipe Image</th>
                        <th scope="col" class="text-end px-4">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for recipe in recipes %}
                    <tr>
                        <th scope="row" class="px-4">{{forloop.counter}}</th>
                        <td class="fw-semibold">{{recipe.recipe_name}}</td>
                        <td class="text-muted">{{recipe.recipe_des|truncatechars:100}}</td>
                        <td>
                            {% if recipe.recipe_image %}
                                <img src="/media/{{recipe.recipe_image}}" class="rounded" style="height: 80px; width: 80px; object-fit: cover;">
                            {% else %}
                                <span class="badge bg-light text-dark">No image</span>
                            {% endif %}
                        </td>
                        <td class="text-end px-4">
                            <a href="/delete/{{recipe.id}}/" class="btn btn-outline-danger btn-sm me-2" onclick="return confirm('Are you sure you want to delete this recipe?')">Delete</a>
                            <a href="/update/{{recipe.id}}/" class="btn btn-outline-primary btn-sm">Update</a>
                            <a onclick="toggleLabel()" class="btn btn-outline-danger btn-sm favs" data-recipe-id="{{recipe.id}}">♡</a>


                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-4">
                            <p class="text-muted mb-0">
                                {% if request.GET.search %}
                                    No recipes found matching "{{ request.GET.search }}"
                                {% else %}
                                    No recipes added yet
                                {% endif %}
                            </p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* Card Styling */
    .card {
        border-radius: 15px;
        transition: transform 0.2s;
    }
    
    /* Form Controls */
    .form-control, .input-group-text, .btn {
        padding: 0.75rem 1rem;
    }
    
    .form-control {
        border: 1px solid #dee2e6;
    }
    
    .form-control:focus {
        box-shadow: none;
        border-color: #0d6efd;
    }
    
    .input-group-text {
        color: #6c757d;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
    }
    
    /* Button Styling */
    .btn-primary {
        background-color: #0d6efd;
        border: none;
        transition: all 0.2s;
    }
    
    .btn-primary:hover {
        background-color: #0b5ed7;
        transform: translateY(-1px);
    }
    
    .btn-outline-primary, .btn-outline-danger {
        border-width: 1px;
        transition: all 0.2s;
    }
    
    .btn-outline-primary:hover, .btn-outline-danger:hover {
        transform: translateY(-1px);
    }
    
    /* Table Styling */
    .table th {
        font-weight: 600;
        color: #495057;
    }
    
    .table td, .table th {
        padding: 1rem;
        vertical-align: middle;
    }
    
    .table tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    /* Image Styling */
    img.rounded {
        border: 1px solid #dee2e6;
        background-color: #fff;
        padding: 2px;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .table td, .table th {
            padding: 0.75rem;
        }
        
        .card-body {
            padding: 1rem;
        }
    }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get all favorite buttons
    const favButtons = document.querySelectorAll('.favs');
    
    favButtons.forEach(button => {
        // Add click event listener to each button
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const recipeId = this.dataset.recipeId;
            
            // Send AJAX request
            fetch(`/toggle-favorite/${recipeId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Update button appearance
                    this.innerHTML = data.is_favorite ? '❤️' : '♡';
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });
    
    // Function to get CSRF token from cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
</script>

{% endblock %}